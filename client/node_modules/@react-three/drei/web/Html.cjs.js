"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),t=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),r=require("react"),n=require("react-three-fiber"),o=require("three"),a=require("react-dom");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=i(e),l=i(t),u=new o.Vector3,c=new o.Vector3,d=new o.Vector3;function f(e,t,r){var n=u.setFromMatrixPosition(e.matrixWorld);n.project(t);var o=r.width/2,a=r.height/2;return[n.x*o+o,-n.y*a+a]}var m=function(e){return Math.abs(e)<1e-10?0:e};function p(e,t,r){void 0===r&&(r="");for(var n="matrix3d(",o=0;16!==o;o++)n+=m(t[o]*e.elements[o])+(15!==o?",":")");return r+n}var h,v=(h=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],function(e){return p(e,h)}),x=function(e,t){return p(e,[1/(r=t),1/r,1/r,1,-1/r,-1/r,-1/r,-1,1/r,1/r,1/r,1,1,1,1,1],"translate(-50%,-50%)");var r},M=r.forwardRef((function(e,t){var i,p=e.children,h=e.eps,M=void 0===h?.001:h,y=e.style,b=e.className,g=e.prepend,w=e.center,P=e.fullscreen,W=e.portal,E=e.distanceFactor,F=e.sprite,R=void 0!==F&&F,T=e.transform,C=void 0!==T&&T,z=e.zIndexRange,I=void 0===z?[16777271,0]:z,q=e.calculatePosition,N=void 0===q?f:q,j=l.default(e,["children","eps","style","className","prepend","center","fullscreen","portal","distanceFactor","sprite","transform","zIndexRange","calculatePosition"]),H=n.useThree(),L=H.gl,O=H.scene,V=H.camera,S=H.size,_=r.useState((function(){return document.createElement("div")}))[0],k=r.useRef(null),A=r.useRef(0),D=r.useRef([0,0]),Z=r.useRef(null),B=r.useRef(null),G=null!=(i=null==W?void 0:W.current)?i:L.domElement.parentNode;r.useEffect((function(){if(k.current){if(O.updateMatrixWorld(),C)_.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{var e=N(k.current,V,S);_.style.cssText="position:absolute;top:0;left:0;transform:translate3d("+e[0]+"px,"+e[1]+"px,0);transform-origin:0 0;"}return G&&(g?G.prepend(_):G.appendChild(_)),function(){G&&G.removeChild(_),a.unmountComponentAtNode(_)}}}),[G,C]);var J=r.useMemo((function(){return C?{position:"absolute",top:0,left:0,width:S.width,height:S.height,transformStyle:"preserve-3d",pointerEvents:"none"}:s.default({position:"absolute",transform:w?"translate3d(-50%,-50%,0)":"none"},P&&{top:-S.height/2,left:-S.width/2,width:S.width,height:S.height},y)}),[y,w,P,S,C]),K=r.useMemo((function(){return s.default({position:"absolute",pointerEvents:"auto"},y)}),[y]);return r.useLayoutEffect((function(){C?a.render(r.createElement("div",{ref:Z,style:J},r.createElement("div",{ref:B,style:K},r.createElement("div",{ref:t,className:b,children:p}))),_):a.render(r.createElement("div",{ref:t,style:J,className:b,children:p}),_)})),n.useFrame((function(){if(k.current){V.updateMatrixWorld();var e=C?D.current:N(k.current,V,S);if(C||Math.abs(A.current-V.zoom)>M||Math.abs(D.current[0]-e[0])>M||Math.abs(D.current[1]-e[1])>M){if(_.style.display=function(e,t){var r=u.setFromMatrixPosition(e.matrixWorld),n=c.setFromMatrixPosition(t.matrixWorld),o=r.sub(n),a=t.getWorldDirection(d);return o.angleTo(a)>Math.PI/2}(k.current,V)?"none":"block",_.style.zIndex=""+function(e,t,r){if(t instanceof o.PerspectiveCamera||t instanceof o.OrthographicCamera){var n=u.setFromMatrixPosition(e.matrixWorld),a=c.setFromMatrixPosition(t.matrixWorld),i=n.distanceTo(a),s=(r[1]-r[0])/(t.far-t.near),l=r[1]-s*t.far;return Math.round(s*i+l)}}(k.current,V,I),C){var t=S.width/2,r=S.height/2,n=V.projectionMatrix.elements[5]*r,a=V,i=a.isOrthographicCamera,s=a.top,l=a.left,f=a.bottom,p=a.right,h=v(V.matrixWorldInverse),y=i?"scale("+n+")translate("+m(-(p+l)/2)+"px,"+m((s+f)/2)+"px)":"translateZ("+n+"px)",b=k.current.matrixWorld;R&&((b=V.matrixWorldInverse.clone().transpose().copyPosition(b).scale(k.current.scale)).elements[3]=b.elements[7]=b.elements[11]=0,b.elements[15]=1),_.style.width=S.width+"px",_.style.height=S.height+"px",_.style.perspective=i?"":n+"px",Z.current&&B.current&&(Z.current.style.transform=""+y+h+"translate("+t+"px,"+r+"px)",B.current.style.transform=x(b,1/((E||10)/400)))}else{var g=void 0===E?1:function(e,t){if(t instanceof o.OrthographicCamera)return t.zoom;if(t instanceof o.PerspectiveCamera){var r=u.setFromMatrixPosition(e.matrixWorld),n=c.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,i=r.distanceTo(n);return 1/(2*Math.tan(a/2)*i)}return 1}(k.current,V)*E;_.style.transform="translate3d("+e[0]+"px,"+e[1]+"px,0) scale("+g+")"}D.current=e,A.current=V.zoom}}})),r.createElement("group",s.default({},j,{ref:k}))})),y=r.forwardRef((function(e,t){return r.useEffect((function(){console.warn("The <HTML> component was renamed to <Html>")}),[]),r.createElement(M,s.default({},e,{ref:t}))}));exports.HTML=y,exports.Html=M;
